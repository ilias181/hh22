(function(){const i=(...t)=>{var e;return(e=window.location.href)!=null&&e.includes("debug")?console.log("[RB]",...t):null};if(!window.PerformanceObserver||!window.performance){i("Preload image checker script not loaded, PerformanceObserver not supported");return}function l(t){const e=window.getComputedStyle(t),r=e.backgroundImage||e.background;if(r.includes("url"))return r.replace(/"/g,"").replace(/url\(|\)$/gi,"")}async function u(){return new Promise(t=>{new PerformanceObserver(e=>{const r=e.getEntries(),a=r[r.length-1],d=a.renderTime||a.loadTime;t(a)}).observe({type:"largest-contentful-paint",buffered:!0})})}async function m(){return new Promise(t=>{new PerformanceObserver(e=>{const[r]=e.getEntriesByType("navigation");t(r.responseStart)}).observe({type:"navigation",buffered:!0})})}i("Preload image checker script loaded");async function g(){var t,e;const r=await m(),a=performance.getEntriesByType("resource").filter(n=>n.initiatorType==="link"&&n.name.match(/jpe?g|png|webp/)&&n.fetchStart<r+250);if(!a.length){i("No preloaded images found");return}const d=Array.from(document.querySelectorAll("img,div")).flatMap(n=>[n.src,n.currentSrc,l(n)]).filter(n=>n?.match(/jpe?g|png|webp/));for(const n of a){const c=n.name,p=new URL(c).pathname;if(d.find(o=>o.includes(p)))i(`LCP image successfully preloaded: ${c}`);else{const o=await u(),s={type:"preload-mismatch",preloadedSrc:c,pathname:window.location.pathname,windowWidth:window.innerWidth,windowHeight:window.innerHeight,queryParams:window.location.search,lcp:{loadTime:o.renderTime||o.loadTime,url:o.url,html:o.element.outerHTML}};i(`No matching image found for ${c}. The URL ${o.url} was identified as the LCP image.`,s);const f=window.location.href.includes("rb_stage")||document.cookie.includes("rb-stage=")?"?rb_stage":"";await fetch(`/rb-analytics/preload-mismatch${f}`,{method:"POST",headers:{"Content-Type":"application/json","x-rb-trace-id":((e=(t=window?.renderbetter)==null?void 0:t.analyticsProperties)==null?void 0:e.traceId)||""},body:JSON.stringify(s)})}}}document.addEventListener("DOMContentLoaded",function(){setTimeout(g,5e3)})})();
