const _RenderBetter=class{constructor(){this.queue=[],this.analyticsProperties={},this.isInitialized=!1,this.windowErrors=[],this.longTasks=[],this.rbApiDomain="api.renderbetter.app",this.onInitializedEvents=[],this.getLogger=t=>(...i)=>{this.dbg&&console.log(`%c[${t}]`,"color: white; font-weight: bold;",...i)},this.collect=t=>{this.log("Queueing analytics metric",t),this.queue.push(t),this.triggerAnalyticsCollectedEvent()},this.triggerAnalyticsCollectedEvent=()=>{setTimeout(()=>{document.dispatchEvent(new CustomEvent("rb-analytics-collected"))},0)},this.getCookie=async t=>{var i;return this.getCookieOverride?await this.getCookieOverride(t):(i=document.cookie.split(";").find(s=>s.trim().startsWith(t)))==null?void 0:i.split("=")[1]},this.setCookie=async t=>{const i=this.setCookieOverride?async s=>await this.setCookieOverride(s):async s=>Promise.resolve(document.cookie=s);this.sharedDomain?(await i(`${t}; Max-Age=0;`),await i(`${t}; Domain=${this.sharedDomain};`)):await i(t)},this.getOrSetAnonymousIdAndSessionId=async()=>{const t=await this.getCookie(_RenderBetter.SESSION_ID_COOKIE_NAME);if(!t){if(!await this.canCollectAnalytics())return;const{anonymousId:u,sessionId:m}=await this.getNewSessionId();return this.setSessionId(u,1),{anonymousId:u,sessionId:m}}const[i,s,a]=t.split(".");if(i&&!s)return this.setSessionId(i,1),{anonymousId:i,sessionId:`${i}.${s||1}`};if(i?.length!==36||!i&&!s&&!a){const{anonymousId:I,sessionId:u}=await this.getNewSessionId();return this.setSessionId(I,1),{anonymousId:I,sessionId:u}}let d=parseInt(s);const g=parseInt(a);return(Date.now()-g>18e5||new Date(g).toDateString()!==new Date().toDateString())&&(d=d+1),this.setSessionId(i,d),{anonymousId:i,sessionId:`${i}.${d}`}},this.getNewSessionId=async()=>{const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=Math.random()*16|0;return(i=="x"?s:s&3|8).toString(16)});return{anonymousId:t,sessionId:t+".1"}},this.setSessionId=async(t,i)=>{this.rbAnonymousId=t,this.rbSessionId=`${t}.${i}`;const s=`${t}.${i}.${Date.now()}`;await this.setCookie(`${_RenderBetter.SESSION_ID_COOKIE_NAME}=${s}; ${this.defaultCookieArgs}`)},this.setIdentifierProperties=async()=>{if(!this.rbAnonymousId||!this.rbSessionId||!this.analyticsProperties.experimentId||!this.analyticsProperties.variantId){const{experimentId:t,variantId:i,anonymousId:s,sessionId:a}=await this.getIdentifiersFromCookie()||{};this.rbAnonymousId=this.rbAnonymousId||s,this.rbSessionId=this.rbSessionId||a,this.analyticsProperties.experimentId=this.analyticsProperties.experimentId||t,this.analyticsProperties.variantId=this.analyticsProperties.variantId||i}},this.getIdentifiersFromCookie=async()=>{const t=await this.getOrSetAnonymousIdAndSessionId(),i=await this.getExperimentViewedCookie(),s=await this.getCookie(_RenderBetter.VARIANT_ID_COOKIE_NAME);return{experimentId:i?.experimentId,variantId:s||i?.variantId,anonymousId:t?.anonymousId||i?.sessionId.split(".")[0],sessionId:t?.sessionId||i?.sessionId}},this.getExperimentViewedCookie=async()=>{const t=await this.getCookie(_RenderBetter.EXPERIMENT_VIEWED_COOKIE_NAME);if(!t){await this.canCollectAnalytics()&&this.reportError("Missing experiment viewed cookie");return}const[i,s,a]=t.split(":");if(!i||!s||!a){this.reportError("Invalid experiment viewed cookie",{cookie:t});return}return{experimentId:i,variantId:s,sessionId:a}};var n,o,r,l,c;this.log=this.getLogger("RB Analytics"),this.dbg=window.location.href.indexOf("debug")>-1||document.cookie.indexOf("debug")>-1;const h=(n=document.currentScript)==null?void 0:n.getAttribute("data-analytics");let e={};h&&(e=JSON.parse(atob(h))),this.isConsentRequired=this.getConfigSetting(e,"gdpr","data-gdpr",!1)==="true",this.sharedDomain=this.getConfigSetting(e,"sharedDomain","data-shared-domain",!1),this.rbSessionId=this.getConfigSetting(e,"sessionId","data-session-id",!1),this.rbAnonymousId=this.getConfigSetting(e,"anonymousId","data-anonymous-id",!1),this.rbApiDomain=e?.apiDomainOverride||this.rbApiDomain,this.analyticsProperties={pageOptimized:e?.pageOptimized,optimizationCount:e?.optimizationCount,botScore:e?.botScore,experimentId:e?.experimentId,variantId:e?.variantId,traceId:e?.traceId,isFirstVisit:e?.isFirstVisit,isOriginCached:e?.isOriginCached,isLoggedIn:e?.isLoggedIn,colo:e?.colo,city:e?.city,country:e?.country,customerAbVariant:e?.customerAbVariant,theme:`${(o=window.Shopify)==null?void 0:o.theme.id} (${(r=window.Shopify)==null?void 0:r.theme.name})`},(l=document.currentScript)!=null&&l.getCookie&&(this.getCookieOverride=document.currentScript.getCookie),(c=document.currentScript)!=null&&c.setCookie&&(this.setCookieOverride=document.currentScript.setCookie),this.initialize()}async grantCookieConsent(n){if(await this.setCookie(`${_RenderBetter.CONSENT_COOKIE_NAME}=${n}; ${this.defaultCookieArgs}`),n===!0){this.log("Enabling analytics collection");const o=await this.getOrSetAnonymousIdAndSessionId();o&&(this.log("Dispatching rb-session-id event",o),document.dispatchEvent(new CustomEvent("rb-session-id",{detail:o}))),this.triggerAnalyticsCollectedEvent()}else this.log("Disabling analytics collection")}async canCollectAnalytics(){return this.isConsentRequired?await this.getCookie(_RenderBetter.CONSENT_COOKIE_NAME)==="true":!0}initializePerformanceListeners(){if(window.addEventListener("error",n=>{this.windowErrors.push(n)}),typeof window.PerformanceObserver=="function"&&typeof window.PerformanceLongTaskTiming=="function"){const n=new window.PerformanceObserver(o=>{for(const r of o.getEntries())this.longTasks.push(r)});try{n.observe({entryTypes:["longtask"]})}catch(o){this.log("Failed to observe long tasks",o)}}}async reportError(n,o){var r;try{await fetch(`https://${this.rbApiDomain}/rb-analytics/client-side-error`,{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json","x-rb-trace-id":((r=this.analyticsProperties)==null?void 0:r.traceId)||"","x-rb-referer":window.location.href},body:JSON.stringify({message:n,currentUrl:window.location.href,...o,type:"client-side-error"})})}catch(l){console.warn("Failed to send error to Render Better",l)}}addInitializedListener(n){this.isInitialized?n():this.onInitializedEvents.push(n)}async initialize(){if(window.self===window.top&&this.collect({name:"page_viewed",type:"metric"}),this.isConsentRequired===!1||await this.canCollectAnalytics())this.log("Tracking consent is satisfied, initializing analytics.");else{this.log("Analytics collection disabled for compliance, preventing analytics collection."),this.fireInitializedEvent();return}this.initializePerformanceListeners(),await this.setIdentifierProperties(),this.log("Initialized analytics",{sharedDomain:this.sharedDomain,analyticsProperties:this.analyticsProperties,rbAnonymousId:this.rbAnonymousId,rbSessionId:this.rbSessionId}),this.sharedDomain||console.error("[RB Analytics] Missing shared domain. Render Better Analytics may not work as expected."),this.fireInitializedEvent()}fireInitializedEvent(){this.isInitialized=!0,document.dispatchEvent(new CustomEvent("rb-analytics-initialized")),this.onInitializedEvents.forEach(n=>n())}getConfigSetting(n,o,r,l=!0){var c;const h=n[o]||((c=document.currentScript)==null?void 0:c.getAttribute(r));if(!h&&l)throw new Error(`[RB Analytics] Missing '${o}' or '${r}' config setting. Render Better Analytics may not work as expected.`);return h}get defaultCookieArgs(){return this.sharedDomain?`path=/; max-age=${63072e6}; domain=${this.sharedDomain};`:`path=/; max-age=${63072e6};`}};let RenderBetter=_RenderBetter;RenderBetter.CONSENT_COOKIE_NAME="rb-analytics-consent",RenderBetter.EXPERIMENT_VIEWED_COOKIE_NAME="rb-exp",RenderBetter.SESSION_ID_COOKIE_NAME="rb-session-id",RenderBetter.VARIANT_ID_COOKIE_NAME="rb-ab",window.renderbetter=new RenderBetter;!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Perfume={})}(this,function(e){"use strict";function F(){return d.deviceMemory}function _(){return d.hardwareConcurrency}function i(){return p&&p.getEntriesByType&&p.now&&p.mark}function q(){c.isHidden=!1,document.hidden&&(c.isHidden=document.hidden,c.didChange=!0)}function R(){return!!(_()&&_()<=4)||!!(F()&&F()<=4)}var t,n,f={isResourceTiming:!1,isElementTiming:!1,maxTime:3e4,reportOptions:{},enableNavigationTracking:!0},l=window,A=l.console,d=l.navigator,p=l.performance,m="mark.",H="4g",z=!1,a={},W={value:0},U={value:{beacon:0,css:0,fetch:0,img:0,other:0,script:0,total:0,xmlhttprequest:0}},V={value:0},r={value:0},G={},c={isHidden:!1,didChange:!1},J=function(e,t){try{var n=new PerformanceObserver(function(e){t(e.getEntries())});return n.observe({type:e,buffered:!0}),n}catch(e){A.warn("Perfume.js:",e)}return null},o=function(e){return parseFloat(e.toFixed(4))},s=function(e){return"number"!=typeof e?null:o(e/Math.pow(1024,2))},K=function(e,t,n,r,i){function a(){!f.analyticsTracker||c.isHidden&&!["CLS","INP"].includes(e)||f.analyticsTracker({attribution:r,metricName:e,data:t,navigatorInformation:d?{deviceMemory:F()||0,hardwareConcurrency:_()||0,serviceWorkerStatus:"serviceWorker"in d?d.serviceWorker.controller?"controlled":"supported":"unsupported",isLowEndDevice:R(),isLowEndExperience:function(e){switch(H){case"slow-2g":case"2g":case"3g":return!0;default:return R()||e}}(z)}:{},rating:n,navigationType:i})}var o;["CLS","INP"].includes(e)?a():(o=a,"requestIdleCallback"in l?l.requestIdleCallback(o,{timeout:3e3}):o())},Q=function(e){e.forEach(function(e){var t;"self"!==e.name||e.startTime<W.value||0<(t=e.duration-50)&&(V.value+=t,r.value+=t)})};function X(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0}function Y(){addEventListener("visibilitychange",P,!0),addEventListener("prerenderingchange",P,!0)}function Z(e,t){v||(v=t,h=e,ue=new Date,ee(removeEventListener),$())}function $(){var t;0<=h&&h<ue-ye&&(t={entryType:"first-input",name:v.type,target:v.target,cancelable:v.cancelable,startTime:v.timeStamp,processingStart:v.timeStamp+h},g.forEach(function(e){e(t)}),g=[])}function ee(t){["mousedown","keydown","touchstart","pointerdown"].forEach(function(e){return t(e,ke,N)})}function te(e){e.forEach(function(e){e.interactionId&&(Ee=Math.min(Ee,e.interactionId),Me=Math.max(Me,e.interactionId),Se=Me?(Me-Ee)/7+1:0)})}function ne(){return le?Se:performance.interactionCount||0}function re(){return ne()-we}function ie(e){var t=j[j.length-1],n=Ce[e.interactionId];(n||j.length<10||e.duration>t.latency)&&(n?(n.entries.push(e),n.latency=Math.max(n.latency,e.duration)):(t={id:e.interactionId,latency:e.duration,entries:[e]},Ce[t.id]=t,j.push(t)),j.sort(function(e,t){return t.latency-e.latency}),j.splice(10).forEach(function(e){delete Ce[e.id]}))}function ae(e){var t="usageDetails"in e?e.usageDetails:{};T("storageEstimate",{quota:s(e.quota),usage:s(e.usage),caches:s(t.caches),indexedDB:s(t.indexedDB),serviceWorker:s(t.serviceWorkerRegistrations)})}function oe(e){delete I.active[e]}function u(e){var t;return null!=(t=Ne()[e])?t:{}}function ce(){var n,e,t,r=Ne(),i=I.startMarkToStepsMap,r=Object.keys(r).length;return 0===r?{}:(n={},t=u(e=r-1),Object.keys(t).forEach(function(e){var t=null!=(t=i[e])?t:[];Object.keys(t).forEach(function(e){n[e]=!0})}),1<r&&(t=u(e-1),Object.keys(t).forEach(function(e){var t=null!=(t=i[e])?t:[];Object.keys(t).forEach(function(e){n[e]=!0})})),n)}function se(d){var e,t,n,r,i,a,o,c,s;I.finalMarkToStepsMap[d]?(n=d,a=I.navigationSteps,o=I.finalMarkToStepsMap,0!==(c=Object.keys(a).length)&&(i=u(r=c-1))&&o[n]&&(o=o[n])&&Object.keys(o).forEach(function(e){var t,n;i[e]&&((t=u(r)||{})[e]=!1,a[r]=t),1<c&&(n=u(t=r-1))[e]&&(n[e]=!1,a[t]=n)}),t=I.finalMarkToStepsMap[d],Object.keys(t).forEach(function(l){var e=t[l];e.forEach(oe),Promise.all(e.map(function(u){return c=function(){return r=this,i=function(e){switch(e.label){case 0:return[4,(n=d,o="step."+(t=u),c=0<p.getEntriesByName(m+(a=l)).length,void(0<p.getEntriesByName(m+n).length&&f.steps&&(r=(i=de[f.steps[t].threshold]).maxOutlierThreshold,i=i.vitalsThresholds,c)&&(o=(c=p.measure(o,m+a,m+n)).duration)<=r&&(a=o<=i[0]?"good":o<=i[1]?"needsImprovement":"poor",0<=o)&&(K("userJourneyStep",o,a,{stepName:t},void 0),p.measure("step.".concat(t,"_vitals_").concat(a),{start:c.startTime+c.duration,end:c.startTime+c.duration,detail:{type:"stepVital",duration:o}}))))];case 1:return e.sent(),[2]}var t,n,r,i,a,o,c},s={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(n){return function(e){var t=[n,e];if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,o&&(c=2&t[0]?o.return:t[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,t[1])).done)return c;switch(o=0,(t=c?[2&t[0],c.value]:t)[0]){case 0:case 1:c=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!((c=0<(c=s.trys).length&&c[c.length-1])||6!==t[0]&&2!==t[0])){s=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3]))s.label=t[1];else if(6===t[0]&&s.label<c[1])s.label=c[1],c=t;else{if(!(c&&s.label<c[2])){c[2]&&s.ops.pop(),s.trys.pop();continue}s.label=c[2],s.ops.push(t)}}t=i.call(r,s)}catch(e){t=[6,e],o=0}finally{a=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}var r,i,a,o,c,s,t},o=e=void 0,new(o=Promise)(function(n,t){function r(e){try{a(c.next(e))}catch(e){t(e)}}function i(e){try{a(c.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?n(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(r,i)}a((c=c.apply(void 0,e||[])).next())});var e,o,c})).catch(function(){})})):(n=d,o=I.navigationSteps,(e=u(s=(0<(s=Object.keys(o).length)?s:1)-1)||[])[n]=!0,o[s]=e,o=null!=(n=I.startMarkToStepsMap[d])?n:[],Object.keys(o).forEach(function(e){I.active[e]||(I.active[e]=!0)})),f.enableNavigationTracking?(s=ce(),null!=(e=f.onMarkStep)&&e.call(f,d,Object.keys(s))):null!=(n=f.onMarkStep)&&n.call(f,d,Object.keys(I.active))}t={instant:"instant",quick:"quick",moderate:"moderate",slow:"slow",unavoidable:"unavoidable"},(n={})[t.instant]={vitalsThresholds:[100,200],maxOutlierThreshold:1e4},n[t.quick]={vitalsThresholds:[200,500],maxOutlierThreshold:1e4},n[t.moderate]={vitalsThresholds:[500,1e3],maxOutlierThreshold:1e4},n[t.slow]={vitalsThresholds:[1e3,2e3],maxOutlierThreshold:1e4},n[t.unavoidable]={vitalsThresholds:[2e3,5e3],maxOutlierThreshold:2e4};var v,h,ue,g,le,de=n,fe={RT:[100,200],TBT:[200,600],NTBT:[200,600]},pe=function(e,t){return fe[e]?t<=fe[e][0]?"good":t<=fe[e][1]?"needsImprovement":"poor":null},T=function(e,t,n){Object.keys(t).forEach(function(e){"number"==typeof t[e]&&(t[e]=o(t[e]))}),K(e,t,null,n||{})},y=function(e){var t=e.attribution,n=e.name,r=e.rating,i=e.value,a=e.navigationType,i=("FCP"===n&&(W.value=i),["FCP","LCP"].includes(n)&&!G[0]&&(G[0]=J("longtask",Q)),"FID"===n&&setTimeout(function(){c.didChange||(y({attribution:t,name:"TBT",rating:pe("TBT",V.value),value:V.value,navigationType:a}),T("dataConsumption",U.value))},1e4),o(i));i<=f.maxTime&&0<=i&&K(n,i,r,t,a)},k=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},b=function(e){if("loading"===document.readyState)return"loading";var t=k();if(t){if(e<t.domInteractive)return"loading";if(0===t.domContentLoadedEventStart||e<t.domContentLoadedEventStart)return"dom-interactive";if(0===t.domComplete||e<t.domComplete)return"dom-content-loaded"}return"complete"},S=function(e,t){var n,r="";try{for(;e&&9!==e.nodeType;){var i=e,a=i.id?"#"+i.id:(n=void 0,n=i.nodeName,(1===i.nodeType?n.toLowerCase():n.toUpperCase().replace(/^#/,""))+(i.className&&i.className.length?"."+i.className.replace(/\s+/g,"."):""));if(r.length+a.length>(t||100)-1)return r||a;if(r=r?a+">"+r:a,i.id)break;e=i.parentNode}}catch(e){}return r},me=-1,ve=function(){return me},E=function(t){addEventListener("pageshow",function(e){e.persisted&&(me=e.timeStamp,t(e))},!0)},M=function(){var e=k();return e&&e.activationStart||0},w=function(e,t){var n=k(),r="navigate";return 0<=ve()?r="back-forward-cache":n&&(r=document.prerendering||0<M()?"prerender":document.wasDiscarded?"restore":n.type.replace(/_/g,"-")),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},C=function(e,t,n){try{var r;if(PerformanceObserver.supportedEntryTypes.includes(e))return(r=new PerformanceObserver(function(e){Promise.resolve().then(function(){t(e.getEntries())})})).observe(Object.assign({type:e,buffered:!0},n||{})),r}catch(e){}},L=function(t,n){function r(e){"pagehide"!==e.type&&"hidden"!==document.visibilityState||(t(e),n&&(removeEventListener("visibilitychange",r,!0),removeEventListener("pagehide",r,!0)))}addEventListener("visibilitychange",r,!0),addEventListener("pagehide",r,!0)},O=function(n,r,i,a){var o,c;return function(e){var t;0<=r.value&&(e||a)&&((c=r.value-(o||0))||void 0===o)&&(o=r.value,r.delta=c,r.rating=(t=r.value)>i[1]?"poor":t>i[0]?"needs-improvement":"good",n(r))}},he=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},x=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},B=-1,P=function(e){"hidden"===document.visibilityState&&-1<B&&(B="visibilitychange"===e.type?e.timeStamp:0,removeEventListener("visibilitychange",P,!0),removeEventListener("prerenderingchange",P,!0))},ge=function(){return B<0&&(B=X(),Y(),E(function(){setTimeout(function(){B=X(),Y()},0)})),{get firstHiddenTime(){return B}}},Te=function(o,c){c=c||{},x(function(){var t,n=[1800,3e3],r=ge(),i=w("FCP"),a=C("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(a.disconnect(),e.startTime<r.firstHiddenTime)&&(i.value=Math.max(e.startTime-M(),0),i.entries.push(e),t(!0))})});a&&(t=O(o,i,n,c.reportAllChanges),E(function(e){i=w("FCP"),t=O(o,i,n,c.reportAllChanges),he(function(){i.value=performance.now()-e.timeStamp,t(!0)})}))})},N={passive:!0,capture:!0},ye=new Date,ke=function(e){var t,n,r,i;function a(){Z(n,r),i()}function o(){i()}e.cancelable&&(t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(n=t,r=e,i=function(){removeEventListener("pointerup",a,N),removeEventListener("pointercancel",o,N)},addEventListener("pointerup",a,N),addEventListener("pointercancel",o,N)):Z(t,e))},be=function(c,s){s=s||{},x(function(){function e(e){e.forEach(i)}var t=[100,300],n=ge(),r=w("FID"),i=function(e){e.startTime<n.firstHiddenTime&&(r.value=e.processingStart-e.startTime,r.entries.push(e),o(!0))},a=C("first-input",e),o=O(c,r,t,s.reportAllChanges);a&&L(function(){e(a.takeRecords()),a.disconnect()},!0),a&&E(function(){var e;r=w("FID"),o=O(c,r,t,s.reportAllChanges),g=[],h=-1,v=null,ee(addEventListener),e=i,g.push(e),$()})})},Se=0,Ee=1/0,Me=0,we=0,j=[],Ce={},Le=function(r,e){var a=function(e){var t,n;(t=e).entries.length?(n=t.entries.sort(function(e,t){return t.duration-e.duration||t.processingEnd-t.processingStart-(e.processingEnd-e.processingStart)})[0],t.attribution={eventTarget:S(n.target),eventType:n.name,eventTime:n.startTime,eventEntry:n,loadState:b(n.startTime)}):t.attribution={},r(e)},o=e||{};x(function(){var e=[200,500];function t(e){e.forEach(function(t){t.interactionId&&ie(t),"first-input"!==t.entryType||j.some(function(e){return e.entries.some(function(e){return t.duration===e.duration&&t.startTime===e.startTime})})||ie(t)});var t=Math.min(j.length-1,Math.floor(re()/50)),t=j[t];t&&t.latency!==n.value&&(n.value=t.latency,n.entries=t.entries,i())}"interactionCount"in performance||(le=le||C("event",te,{type:"event",buffered:!0,durationThreshold:0}));var n=w("INP"),r=C("event",t,{durationThreshold:o.durationThreshold||40}),i=O(a,n,e,o.reportAllChanges);r&&(r.observe({type:"first-input",buffered:!0}),L(function(){t(r.takeRecords()),n.value<0&&0<re()&&(n.value=0,n.entries=[]),i(!0)}),E(function(){j=[],we=ne(),n=w("INP"),i=O(a,n,e,o.reportAllChanges)}))})},Oe={},xe=function(n,r){r=r||{};var i=[800,1800],a=w("TTFB"),o=O(n,a,i,r.reportAllChanges);!function e(t){document.prerendering?x(function(){return e(t)}):"complete"!==document.readyState?addEventListener("load",function(){return e(t)},!0):setTimeout(t,0)}(function(){var e,t=k();!t||(e=t.responseStart)<=0||e>performance.now()||(a.value=Math.max(e-M(),0),a.entries=[t],o(!0),E(function(){a=w("TTFB",0),(o=O(n,a,i,r.reportAllChanges))(!0)}))})},Be=function(e){e.forEach(function(e){e.identifier&&y({attribution:{identifier:e.identifier},name:"ET",rating:null,value:e.startTime})})},Pe=function(e){e.forEach(function(e){var t;f.isResourceTiming&&T("resourceTiming",e),e.decodedBodySize&&e.initiatorType&&(t=e.decodedBodySize/1e3,U.value[e.initiatorType]+=t,U.value.total+=t)})},I={finalMarkToStepsMap:{},startMarkToStepsMap:{},active:{},navigationSteps:{}},Ne=function(){return I.navigationSteps},je=0;function D(e){var t,n,c,s,u,r;void 0===e&&(e={}),this.v="9.0.0-rc.3",f.analyticsTracker=e.analyticsTracker,f.isResourceTiming=!!e.resourceTiming,f.isElementTiming=!!e.elementTiming,f.maxTime=e.maxMeasureTime||f.maxTime,f.reportOptions=e.reportOptions||f.reportOptions,f.steps=e.steps,f.onMarkStep=e.onMarkStep,f.enableNavigationTracking=e.enableNavigationTracking,i()&&("PerformanceObserver"in l&&(r=f.reportOptions.ttfb,xe(function(e){var t,n,r,i,a;(t=e).entries.length?(a=(n=t.entries[0]).activationStart||0,r=Math.max(n.domainLookupStart-a,0),i=Math.max(n.connectStart-a,0),a=Math.max(n.requestStart-a,0),t.attribution={waitingTime:r,dnsTime:i-r,connectionTime:a-i,requestTime:t.value-a,navigationEntry:n}):t.attribution={waitingTime:0,dnsTime:0,connectionTime:0,requestTime:0},0<e.value&&y(e)},r),r=f.reportOptions.cls,u=r||{},x(function(){function e(e){var t;-1<a&&(function(e){if(e.entries.length){var t=e.entries.reduce(function(e,t){return e&&e.value>t.value?e:t});if(t&&t.sources&&t.sources.length){n=(n=t.sources).find(function(e){return e.node&&1===e.node.nodeType})||n[0];if(n)return e.attribution={largestShiftTarget:S(n.node),largestShiftTime:t.startTime,largestShiftValue:t.value,largestShiftSource:n,largestShiftEntry:t,loadState:b(t.startTime)}}}var n;e.attribution={}}(t=e),y(t))}function t(e){e.forEach(function(e){var t,n;e.hadRecentInput||(t=c[0],n=c[c.length-1],o&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(o+=e.value,c.push(e)):(o=e.value,c=[e]),o>i.value&&(i.value=o,i.entries=c,r()))})}var r,n=[.1,.25],i=w("CLS"),a=-1,o=0,c=[],s=C("layout-shift",t);s&&(r=O(e,i,n,u.reportAllChanges),Te(function(e){a=e.value,i.value<0&&(i.value=0,r())}),L(function(){t(s.takeRecords()),r(!0)}),E(function(){a=-1,i=w("CLS",o=0),r=O(e,i,n,u.reportAllChanges),he(function(){return r()})}))}),r=f.reportOptions.fcp,Te(function(e){!function(e){if(e.entries.length){var t,n=k(),r=e.entries[e.entries.length-1];if(n)return t=n.activationStart||0,t=Math.max(0,n.responseStart-t),e.attribution={timeToFirstByte:t,firstByteToFCP:e.value-t,loadState:b(e.entries[0].startTime),navigationEntry:n,fcpEntry:r}}e.attribution={timeToFirstByte:0,firstByteToFCP:e.value,loadState:b(ve())}}(e),y(e)},r),r=f.reportOptions.fid,be(function(e){var t=e.entries[0];e.attribution={eventTarget:S(t.target),eventType:t.name,eventTime:t.startTime,eventEntry:t,loadState:b(t.startTime)},y(e)},r),r=f.reportOptions.lcp,c=function(e){!function(e){if(e.entries.length){var t,n,r,i,a,o,c=k();if(c)return a=c.activationStart||0,n=(t=e.entries[e.entries.length-1]).url&&performance.getEntriesByType("resource").filter(function(e){return e.name===t.url})[0],o=Math.max(0,c.responseStart-a),r=Math.max(o,n?(n.requestStart||n.startTime)-a:0),i=Math.max(r,n?n.responseEnd-a:0),a=Math.max(i,t?t.startTime-a:0),o={element:S(t.element),timeToFirstByte:o,resourceLoadDelay:r-o,resourceLoadTime:i-r,elementRenderDelay:a-i,navigationEntry:c,lcpEntry:t},t.url&&(o.url=t.url),n&&(o.lcpResourceEntry=n),e.attribution=o}e.attribution={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadTime:0,elementRenderDelay:e.value}}(e),y(e)},s=r||{},x(function(){var r,t,n=[2500,4e3],i=ge(),a=w("LCP"),e=function(e){var t,n=e[e.length-1];n&&(t=Math.max(n.startTime-M(),0))<i.firstHiddenTime&&(a.value=t,a.entries=[n],r())},o=C("largest-contentful-paint",e);o&&(r=O(c,a,n,s.reportAllChanges),t=function(){Oe[a.id]||(e(o.takeRecords()),o.disconnect(),Oe[a.id]=!0,r(!0))},["keydown","click"].forEach(function(e){addEventListener(e,t,{once:!0,capture:!0})}),L(t,!0),E(function(e){a=w("LCP"),r=O(c,a,n,s.reportAllChanges),he(function(){a.value=performance.now()-e.timeStamp,Oe[a.id]=!0,r(!0)})}))}),Le(function(e){return y(e)},f.reportOptions.inp),f.isResourceTiming&&J("resource",Pe),f.isElementTiming)&&J("element",Be),void 0!==document.hidden&&document.addEventListener("visibilitychange",q),n=i()&&(r=p.getEntriesByType("navigation")[0])?(t=r.responseStart,{fetchTime:(n=r.responseEnd)-r.fetchStart,workerTime:0<r.workerStart?n-r.workerStart:0,totalTime:n-r.requestStart,downloadTime:n-t,timeToFirstByte:t-r.requestStart,headerSize:r.transferSize-r.encodedBodySize||0,dnsLookupTime:r.domainLookupEnd-r.domainLookupStart,redirectTime:r.redirectEnd-r.redirectStart}):{},T("navigationTiming",n),n.redirectTime&&y({attribution:{},name:"RT",rating:pe("RT",n.redirectTime),value:n.redirectTime}),T("networkInformation","connection"in d&&"object"==typeof(t=d.connection)?(H=t.effectiveType,z=!!t.saveData,{downlink:t.downlink,effectiveType:t.effectiveType,rtt:t.rtt,saveData:!!t.saveData}):{}),d&&d.storage&&"function"==typeof d.storage.estimate&&d.storage.estimate().then(ae),f.steps)&&f.steps&&(I.startMarkToStepsMap={},I.finalMarkToStepsMap={},I.active={},I.navigationSteps={},Object.entries(f.steps).forEach(function(e){var t=e[0],n=e[1].marks,r=n[0],n=n[1],i=null!=(i=I.startMarkToStepsMap[r])?i:{};i[t]=!0,I.startMarkToStepsMap[r]=i,I.finalMarkToStepsMap[n]?((i=I.finalMarkToStepsMap[n][r]||[]).push(t),I.finalMarkToStepsMap[n][r]=i):I.finalMarkToStepsMap[n]=((i={})[r]=[t],i)}))}D.prototype.start=function(e){i()&&!a[e]&&(a[e]=!0,p.mark("mark_".concat(e,"_start")))},D.prototype.end=function(e,t,n){var r;void 0===t&&(t={}),void 0===n&&(n=!0),i()&&a[e]&&(p.mark("mark_".concat(e,"_end")),delete a[e],p.measure(r=e,"mark_".concat(r,"_start"),"mark_".concat(r,"_end")),r=(r=p.getEntriesByName(r).pop())&&"measure"===r.entryType?r.duration:-1,n)&&T(e,o(r),t)},D.prototype.endPaint=function(e,t){var n=this;setTimeout(function(){n.end(e,t)})},D.prototype.clear=function(e){delete a[e],p.clearMarks&&(p.clearMarks("mark_".concat(e,"_start")),p.clearMarks("mark_".concat(e,"_end")))},D.prototype.markNTBT=function(){var e=this;this.start("ntbt"),r.value=0,clearTimeout(je),je=setTimeout(function(){e.end("ntbt",{},!1),y({attribution:{},name:"NTBT",rating:pe("NTBT",r.value),value:r.value}),r.value=0},2e3)},e.Perfume=D,e.incrementUjNavigation=function(){var e,t=Object.keys(I.navigationSteps).length,t=(I.navigationSteps[t]={},ce());null!=(e=f.onMarkStep)&&e.call(f,"",Object.keys(t))},e.markStep=function(e){p.mark(m+e),se(e)},e.markStepOnce=function(e){0===p.getEntriesByName(m+e).length&&(p.mark(m+e),se(e))},Object.defineProperty(e,"__esModule",{value:!0})});(function(){const i=window.renderbetter.getLogger("RB Analytics CWV"),o=["TTFB","FCP","LCP","FID","CLS","TBT","INP"];new window.Perfume.Perfume({analyticsTracker:({metricName:e,data:n,attribution:t})=>{o.includes(e)&&(i("Queuing CWV metric",e,n),["LCP","CLS","TBT","INP","FID"].includes(e)?l(n,e,t):window.renderbetter.collect({type:"metric",name:e.toLowerCase(),value:n}))}});function l(e,n,t){if(n==="LCP"){const c=performance?.getEntriesByType("resource").filter(r=>r.initiatorType==="link"&&r.name.match(/jpe?g|png|webp/)).map(r=>r.name).join(","),s={...t,preloadedImages:c};window.renderbetter.collect({type:"metric",name:n.toLowerCase(),value:e,attribution:JSON.stringify(s)});return}window.renderbetter.collect({type:"metric",name:n.toLowerCase(),value:e,attribution:JSON.stringify(t)})}})();
(function(){const d=window.renderbetter.getLogger("RB Analytics LoAF");if(!window.PerformanceObserver){d("PerformanceObserver API not supported.");return}let o=[],a=[],s=null;const u=new Map;new PerformanceObserver(r=>{o=[...o,...r.getEntries()]}).observe({type:"long-animation-frame",buffered:!0}),new PerformanceObserver(r=>{const n=Object.values(Object.fromEntries(r.getEntries().map(e=>[JSON.stringify(e),e])));a=[...a,...n],b()}).observe({type:"event",buffered:!0,durationThreshold:150}),document.addEventListener("visibilitychange",l);function g(){const n=[...u.entries()].sort((e,t)=>t.duration-e.duration).map(([e,t])=>{var f;let c=null,m=0;for(const i of e.scripts)m+=i.forcedStyleAndLayoutDuration,i.duration>((f=c?.duration)!=null?f:0)&&(c=i);const _=e.scripts.filter(i=>i.forcedStyleAndLayoutDuration>0||i.duration>50);return{loaf_blocking_duration:e.blockingDuration,event_duration:t.duration,longest_script:c,total_thrashing_duration:m,render_time:e.startTime+e.duration-e.renderStart,loaf:{...e,scripts:_},event:t}});if(n.length===0){d("No long animation frames detected.");return}d(`Long animation frames detected (${n.length}).`,n,JSON.stringify(n)),window.renderbetter.collect({type:"metric",name:"loaf",attribution:JSON.stringify(n)})}function l(){var r,n;for(const e of a)for(const t of o)if(t.blockingDuration&&!(t.startTime+t.duration<e.startTime)){if(t.startTime>e.startTime+e.duration)break;e.duration>((n=(r=u.get(t))==null?void 0:r.duration)!=null?n:0)&&u.set(t,e)}g(),o=[],a=[],u.clear()}function b(){s&&clearTimeout(s),s=setTimeout(()=>{s=null,l()},1e3)}})();
(function(){const o=window.renderbetter.getLogger("RB Analytics Load");if(!window.PerformanceObserver){o("PerformanceObserver API not supported.");return}new PerformanceObserver(n=>{n.getEntries().forEach(e=>{if(e.domComplete===0)return;const t=e.domContentLoadedEventEnd-e.domContentLoadedEventStart,d=e.loadEventEnd-e.loadEventStart,r=JSON.parse(JSON.stringify(e));window.renderbetter.collect({type:"metric",name:"domcontentloaded",value:e.domContentLoadedEventStart,attribution:JSON.stringify({domContentLoadedDuration:t,domContentLoadedEventStart:e.domContentLoadedEventStart,domContentLoadedEventEnd:e.domContentLoadedEventEnd,domComplete:e.domComplete})}),window.renderbetter.collect({type:"metric",name:"load",value:e.loadEventStart,attribution:JSON.stringify({...r,domContentLoadedDuration:t,loadDuration:d})})})}).observe({type:"navigation",buffered:!0})})();
(function l(){var m,b;const c="RB Analytics J";if(!((m=window.renderbetter)!=null&&m.isInitialized)){window.location.href.includes("debug")&&console.log(`[${c}]`,"Render Better Analytics script loaded before Render Better inline analytics script. Analytics will not work until it has been initialized."),window.renderbetter?window.renderbetter.addInitializedListener(l):document.addEventListener("rb-analytics-initialized",l);return}const w="n0DaeCuAbkcu3aTso195HaK1L32CkA9A:RrHUsWBGLEWIAfFvryQxgKafQkjCflBz",u=window.renderbetter.rbAnonymousId,v=window.renderbetter.rbSessionId;let s;const a=window.renderbetter.getLogger(c);if(a("Initializing RB Analytics sink..."),!w){a("No write-key provided, analytics will not be collected.");return}if(!u||!v){a("No session-id provided, analytics will not be collected until tracking consent is granted."),document.addEventListener("rb-session-id",l);return}if((b=window.rbSinks)!=null&&b[c])return;window.rbSinks={...window.rbSinks,[c]:!0};let p=0,y=1e3;h(),document.addEventListener("rb-analytics-collected",h);const g=e=>()=>{a(`Detected '${e}' event. Flushing...`),y=100,h()};document.addEventListener("visibilitychange",g("visibilitychange")),window.addEventListener("beforeunload",g("beforeunload")),window.addEventListener("pagehide",g("pagehide")),a("RB Analytics sink initialized");function h(){s&&(a("Clearing existing flush timeout"),clearTimeout(s)),s=setTimeout(()=>{k(),s&&clearTimeout(s)},y)}async function k(){if(!await window.renderbetter.canCollectAnalytics()){a("Analytics collection disabled, not sending analytics to Render Better");return}const e=window.renderbetter.queue.slice(p);p=window.renderbetter.queue.length,e.length&&(a(`Flushing ${e.map(n=>"name"in n?n.name:n.type).join(", ")} events...`),S([...e]))}async function S(e){if(!w)return a("No write key provided, not sending analytics to Render Better"),!1;if(!await window.renderbetter.canCollectAnalytics())return a("Analytics collection disabled, not sending analytics to Render Better"),!1;const n=window.location.href,i=new URL(n),r=i.pathname.replace(/\/{2,}/g,"/").replace(/\/$/,"")||"/",d=e.map(t=>({type:"track",anonymousId:u,event:"name"in t?t.name:t.type,timestamp:new Date().toISOString(),sentAt:new Date().toISOString(),messageId:I(i?.pathname),properties:{...window.renderbetter.analyticsProperties,url:n,path:r,anonymousId:u,sessionId:v,...t}})),o=JSON.stringify({batch:d,writeKey:w,context:_()});try{if(window.navigator.sendBeacon("https://analytics.renderbetter.net/v1/batch",o))return!0}catch(t){a("sendBeacon failed, falling back to fetch",t)}try{const t=await fetch("https://analytics.renderbetter.net/v1/batch",{keepalive:!0,method:"POST",body:o});return t.ok||await window.renderbetter.reportError("Failed to send analytics to Render Better",{events:e,responseStatus:t.status}),t.ok}catch(t){return t instanceof Error?await window.renderbetter.reportError("Failed to send analytics to Render Better",{error:{message:t.message,stack:t.stack}}):await window.renderbetter.reportError("Failed to send analytics to Render Better",{error:t}),!1}}function E(){const e=window.navigator.userAgent,n={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/internet explorer/i,edge:/edge/i,opera:/opera/i};let i="",r="";for(const t in n)if(n[t].test(e)){i=t;break}const d=new RegExp(`${i}/([0-9.]+)`,"i"),o=e.match(d);return o&&(r=o[1]),{browserName:i,version:r}}function _(){var e,n,i,r;const d=window.location.href,o=new URL(d),t=o.pathname.replace(/\/{2,}/g,"/").replace(/\/$/,"")||"/",f=window.document.referrer,{browserName:B,version:L}=E();return{userAgent:window.navigator.userAgent,userAgentVendor:window.navigator.vendor,browser:B,browser_version:L,locale:window.navigator.language,screen:{width:window.screen.width,height:window.screen.height,innerWidth:window.innerWidth,innerHeight:window.innerHeight,density:Math.floor(window.devicePixelRatio)},network:{effectiveType:(e=window.navigator.connection)==null?void 0:e.effectiveType,downlink:(n=window.navigator.connection)==null?void 0:n.downlink,rtt:(i=window.navigator.connection)==null?void 0:i.rtt,saveData:(r=window.navigator.connection)==null?void 0:r.saveData},page:{path:t,referrer:f,referring_domain:f?new URL(f).hostname:void 0,host:o&&o.host,search:o&&o.search,title:window.document.title,url:d,encoding:window.document.characterSet}}}function I(e=""){const n=Date.now();return(Math.random()*n*R(e??"",A())%Number.MAX_SAFE_INTEGER).toString(36)+(Math.random()*n*R(e??"",A())%Number.MAX_SAFE_INTEGER).toString(36)}function A(){var e;const n=Date.now()%2147483647;return((e=window?.performance)==null?void 0:e.now())||n}function R(e,n=0){let i=3735928559^n,r=1103547991^n;for(let d=0,o;d<e.length;d++)o=e.charCodeAt(d),i=Math.imul(i^o,2654435761),r=Math.imul(r^o,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&r)+(i>>>0)}})();
(function w(){var f,g,v,b;const s="RB Analytics GA4";if(!((f=window.renderbetter)!=null&&f.isInitialized)){window.location.href.includes("debug")&&console.log(`[${s}]`,"Render Better Analytics script loaded before Render Better inline analytics script. Analytics will not work until it has been initialized."),window.renderbetter?window.renderbetter.addInitializedListener(w):document.addEventListener("rb-analytics-initialized",w);return}if((g=window.rbSinks)!=null&&g[s])return;window.rbSinks={...window.rbSinks,[s]:!0};const t=window.renderbetter.getLogger(s),E=((v=document.currentScript)==null?void 0:v.getAttribute("data-debug"))==="true",d=(b=document.currentScript)==null?void 0:b.getAttribute("data-property-id"),z="https://www.google-analytics.com/g/collect";let a,m=0,u=!1;if(!d){t("No property id provided, aborting GA4 initialization");return}document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&(t("Unload detected, flushing events..."),setTimeout(p,0))}),document.addEventListener("rb-analytics-collected",()=>setTimeout(p,100)),y().then(n=>a=n);async function I(){return new Promise(n=>{if(!d){t("No property id provided, cannot get GA4 client id and session id");return}const i=Date.now(),e=setInterval(()=>{var o,r,l,c,h,A;t("Polling for GA4 client id and session id...");const _=(l=(r=(o=("; "+document.cookie).split("; _ga=").pop())==null?void 0:o.split(";").shift())==null?void 0:r.match(/GA1\.[0-9]{1}\.(.+)/))==null?void 0:l[1],G=(A=(h=(c=("; "+document.cookie).split(`; _ga_${d.replace("G-","")}=`).pop())==null?void 0:c.split(";").shift())==null?void 0:h.split("."))==null?void 0:A[2];Date.now()-i>1e4&&(t("Timed out waiting for GA4 client id and session id"),clearInterval(e)),_&&G&&(clearInterval(e),n({clientId:_,sessionId:G}),t("Successfully found GA4 client id and session id"))},100)})}async function y(){const{clientId:n,sessionId:i}=await I();if(!d){t("No property id provided, cannot initialize event model");return}const e={v:2,tid:d,_p:Math.round(2147483647*Math.random()),sr:window.screen.width+"x"+window.screen.height,ul:(window.navigator.language||"").toLowerCase(),cid:n,dl:window.location.href,dt:document.title,sid:i,_s:1};return E===!0&&(e._dbg=1),e}function S(n){return{en:"Web Performance: "+n.name.toUpperCase(),"ep.event_category":"Render Better Analytics","epn.value":n.value,"ep.label":window.renderbetter.analyticsProperties.isPageOptimized?"Render Better Optimized":"Render Better Unoptimized"}}async function p(){if(!await window.renderbetter.canCollectAnalytics()){t("Analytics collection disabled, aborting flush");return}if(u){t("Already flushing, skipping flush");return}if(!a){t("Event model not initialized yet, initializing..."),y().then(p);return}const n=window.renderbetter.queue.slice(m);if(m=window.renderbetter.queue.length,n.length===0){t("No events to flush");return}u=!0,t(`[RB Analytics] Flushing ${n.length} events...`);const i=n.map(e=>e.type==="metric"?S(e):e.type==="experiment_viewed"?R(e):(t("Unknown event type",e),null)).filter(e=>e!==null);try{let e,o;i.length>0&&(i.length===1?Object.assign(a,i[0]):o=i.map(function(r){return Object.entries(r).map(([l,c])=>l+"="+c).join("&")}).join(`
`),e=Object.entries(a).map(([r,l])=>r+"="+encodeURIComponent(l)).join("&"),window.navigator.sendBeacon(z+"?"+e,o),t(`Sent ${i.length} events via beacon`,i))}finally{u=!1}}function R({experimentId:n,variantId:i}){if(n===void 0||i===void 0)return console.warn("[RB Analytics GA4] Experiment ID or Variant ID not provided"),null;const e=`rb-ga4-${n}`,o=window.localStorage.getItem(e);return o===i?(t("Already sent experiment viewed event for this session to GA4"),null):o&&o!==i?(t("Experiment viewed event already sent for this session, but with a different variant ID"),null):(window.localStorage.setItem(e,i),t("Mapping experiment viewed event",n,i),{en:"experiment_viewed","ep.experiment_id":n,"ep.variant_id":i})}})();
(function c(){var f,m;const l="RB Analytics RS";if(!((f=window.renderbetter)!=null&&f.isInitialized)){window.location.href.includes("debug")&&console.log(`[${l}]`,"Render Better Analytics script loaded before Render Better inline analytics script. Analytics will not work until it has been initialized."),window.renderbetter?window.renderbetter.addInitializedListener(c):document.addEventListener("rb-analytics-initialized",c);return}const b="MllnUEtxM1JHUkJvekg3QTVneGc5ZW84bkphOg==",w=window.renderbetter.rbAnonymousId,v=window.renderbetter.rbSessionId;let s;const r=window.renderbetter.getLogger(l);if(r("Initializing RB Analytics sink..."),!b){r("No data-key provided, analytics will not be collected.");return}if(!w||!v){r("No session-id provided, analytics will not be collected until tracking consent is granted."),document.addEventListener("rb-session-id",c);return}if((m=window.rbSinks)!=null&&m[l])return;window.rbSinks={...window.rbSinks,[l]:!0};let y=0,p=1e3;h(),document.addEventListener("rb-analytics-collected",h);const u=e=>()=>{r(`Detected '${e}' event. Flushing...`),p=100,h()};document.addEventListener("visibilitychange",u("visibilitychange")),window.addEventListener("beforeunload",u("beforeunload")),window.addEventListener("pagehide",u("pagehide")),r("RB Analytics sink initialized");function h(){s&&(r("Clearing existing flush timeout"),clearTimeout(s)),s=setTimeout(()=>{k(),s&&clearTimeout(s)},p)}async function k(){if(!await window.renderbetter.canCollectAnalytics()){r("Analytics collection disabled, not sending analytics to Render Better");return}const e=window.renderbetter.queue.slice(y);y=window.renderbetter.queue.length,e.length&&(r(`Flushing ${e.map(t=>"name"in t?t.name:t.type).join(", ")} events...`),_([...e]))}async function _(e){if(!b)return r("No write key provided, not sending analytics to Render Better"),!1;if(!await window.renderbetter.canCollectAnalytics())return r("Analytics collection disabled, not sending analytics to Render Better"),!1;const t=JSON.stringify({batch:e.map(I)});try{if(window.navigator.sendBeacon("https://rs-analytics.renderbetter.net/v1/batch",t))return!0}catch(n){r("sendBeacon failed, falling back to fetch",n)}try{const n=await fetch("https://rs-analytics.renderbetter.net/v1/batch",{keepalive:!0,method:"POST",body:t});return n.ok||await window.renderbetter.reportError("Failed to send analytics to Render Better (RS)",{responseStatus:n.status}),n.ok}catch(n){return n instanceof Error?await window.renderbetter.reportError("Failed to send analytics to Render Better (RS)",{error:{message:n.message,stack:n.stack}}):await window.renderbetter.reportError("Failed to send analytics to Render Better (RS)",{error:n}),!1}}function B(){const e=window.navigator.userAgent,t={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/internet explorer/i,edge:/edge/i,opera:/opera/i};let n="",i="";for(const a in t)if(t[a].test(e)){n=a;break}const d=new RegExp(`${n}/([0-9.]+)`,"i"),o=e.match(d);return o&&(i=o[1]),{browserName:n,version:i}}const I=e=>{var t,n,i,d;const o=window.location.href,a=new URL(o),E=a.pathname.replace(/\/{2,}/g,"/").replace(/\/$/,"")||"/",g=window.document.referrer,{browserName:L,version:D}=B(),M={userAgent:window.navigator.userAgent,userAgentVendor:window.navigator.vendor,browser:L,browser_version:D,locale:window.navigator.language,screen:{width:window.screen.width,height:window.screen.height,innerWidth:window.innerWidth,innerHeight:window.innerHeight,density:Math.floor(window.devicePixelRatio)},network:{effectiveType:(t=window.navigator.connection)==null?void 0:t.effectiveType,downlink:(n=window.navigator.connection)==null?void 0:n.downlink,rtt:(i=window.navigator.connection)==null?void 0:i.rtt,saveData:(d=window.navigator.connection)==null?void 0:d.saveData},page:{path:E,referrer:g,referring_domain:g?new URL(g).hostname:void 0,host:a&&a.host,search:a&&a.search,title:window.document.title,url:o,encoding:window.document.characterSet}},S=T(a?.pathname);return{properties:{...window.renderbetter.analyticsProperties,url:o,path:E,messageId:S,anonymousId:w,sessionId:v,...e},event:"name"in e?e.name:e.type,timestamp:new Date().toISOString(),messageId:S,context:M,anonymousId:w,type:"track"}};function T(e=""){const t=Date.now();return(Math.random()*t*A(e??"",R())%Number.MAX_SAFE_INTEGER).toString(36)+(Math.random()*t*A(e??"",R())%Number.MAX_SAFE_INTEGER).toString(36)}function R(){var e;const t=Date.now()%2147483647;return((e=window?.performance)==null?void 0:e.now())||t}function A(e,t=0){let n=3735928559^t,i=1103547991^t;for(let d=0,o;d<e.length;d++)o=e.charCodeAt(d),n=Math.imul(n^o,2654435761),i=Math.imul(i^o,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&i)+(n>>>0)}})();
